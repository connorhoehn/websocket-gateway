<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Gateway Test Client (SDK)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .connection-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .status {
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .connected { background-color: #d4edda; color: #155724; }
        .disconnected { background-color: #f8d7da; color: #721c24; }
        
        .instructions {
            background-color: #e7f3ff;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #0c5460;
        }
        
        .instructions ul {
            margin-bottom: 0;
        }
        
        .service-section {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .service-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        input, button, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        
        .log-container {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background-color: #f8f9fa;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .log-system { background-color: #e9ecef; }
        .log-chat { background-color: #d1ecf1; }
        .log-presence { background-color: #d4edda; }
        .log-cursor { background-color: #fff3cd; }
        .log-reaction { background-color: #f8d7da; }
        .log-error { background-color: #f8d7da; color: #721c24; }
        .log-success { background-color: #d4edda; color: #155724; }
        .log-info { background-color: #d1ecf1; color: #0c5460; }
        
        .cursor-demo {
            height: 200px;
            border: 2px solid #ddd;
            border-radius: 4px;
            background-color: #f8f9fa;
            position: relative;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .cursor-indicator {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #007bff;
            border-radius: 50%;
            pointer-events: none;
            transition: all 0.1s ease;
        }
        
        .cursor-indicator.own {
            background-color: #28a745;
        }
        
        .cursor-label {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            white-space: nowrap;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .reaction-buttons {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .reaction-button {
            font-size: 20px;
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            background-color: white;
        }
        
        .reaction-button:hover {
            background-color: #f8f9fa;
        }
        
        .reaction-display {
            height: 100px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f8f9fa;
            position: relative;
            overflow: hidden;
        }
        
        .reaction-animation {
            position: absolute;
            font-size: 24px;
            pointer-events: none;
            animation-duration: 1s;
            animation-fill-mode: forwards;
        }
        
        /* Reaction animations */
        @keyframes pulse-red {
            0%, 100% { transform: scale(1); color: #dc3545; }
            50% { transform: scale(1.2); color: #dc3545; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes bounce-green {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes bounce-red {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes zoom {
            0% { transform: scale(0); }
            50% { transform: scale(1.5); }
            100% { transform: scale(1); }
        }

        @keyframes fade-blue {
            0% { opacity: 1; color: #007bff; }
            100% { opacity: 0.3; color: #007bff; }
        }

        @keyframes shake-red {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-3px) rotate(-2deg); }
            75% { transform: translateX(3px) rotate(2deg); }
        }

        @keyframes confetti {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 0.8; }
            100% { transform: scale(0.8) rotate(360deg); opacity: 0; }
        }

        @keyframes flicker-orange {
            0%, 100% { opacity: 1; color: #ff6600; }
            50% { opacity: 0.5; color: #ffaa00; }
        }

        @keyframes flash-yellow {
            0%, 100% { opacity: 1; color: #ffff00; background-color: rgba(255, 255, 0, 0); }
            50% { opacity: 0.8; color: #ffff00; background-color: rgba(255, 255, 0, 0.3); }
        }

        @keyframes spin-gold {
            0% { transform: rotate(0deg); color: #ffd700; }
            100% { transform: rotate(360deg); color: #ffd700; }
        }

        @keyframes fly-up {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(0.5); opacity: 0; }
        }

        .effect-pulse-red { animation: pulse-red 0.5s ease-in-out; }
        .effect-shake { animation: shake 0.5s ease-in-out; }
        .effect-bounce-green { animation: bounce-green 0.5s ease-in-out; }
        .effect-bounce-red { animation: bounce-red 0.5s ease-in-out; }
        .effect-zoom { animation: zoom 0.5s ease-in-out; }
        .effect-fade-blue { animation: fade-blue 0.5s ease-in-out; }
        .effect-shake-red { animation: shake-red 0.5s ease-in-out; }
        .effect-confetti { animation: confetti 1s ease-in-out; }
        .effect-flicker-orange { animation: flicker-orange 0.5s ease-in-out infinite; }
        .effect-flash-yellow { animation: flash-yellow 0.3s ease-in-out; }
        .effect-spin-gold { animation: spin-gold 1s ease-in-out; }
        .effect-fly-up { animation: fly-up 1s ease-in-out; }
    </style>
</head>
<body>
    <!-- Instructions for multi-tab testing -->
    <div class="instructions">
        <h3>🧪 Multi-Tab Testing Instructions</h3>
        <ul>
            <li><strong>Step 1:</strong> Open this page in multiple browser tabs</li>
            <li><strong>Step 2:</strong> Click "Connect" in each tab</li>
            <li><strong>Step 3:</strong> Join the same channel (e.g., "general") in multiple tabs</li>
            <li><strong>Step 4:</strong> Send messages in one tab and watch them appear in other tabs!</li>
            <li><strong>Tip:</strong> Each client gets a unique 8-character ID for identification</li>
        </ul>
    </div>
    <h1>🚀 WebSocket Gateway Test Client (SDK)</h1>
    
    <div class="container">
        <h2>Connection Status</h2>
        <div class="connection-info">
            <div>
                <label for="wsUrl">WebSocket URL:</label>
                <input type="text" id="wsUrl" value="ws://localhost:8080" style="width: 100%; margin-top: 5px;">
            </div>
            <div>
                <button id="connectBtn">Connect</button>
                <button id="disconnectBtn" disabled>Disconnect</button>
            </div>
        </div>
        <div id="connectionStatus" class="status disconnected">Disconnected</div>
        <div id="clientInfo" style="margin-top: 10px; padding: 10px; background-color: #f8f9fa; border-radius: 4px; font-family: monospace; font-size: 12px;">
            <strong>Client ID:</strong> <span id="clientId">Not connected</span><br>
            <strong>Node ID:</strong> <span id="nodeId">Not connected</span><br>
            <strong>Services:</strong> <span id="enabledServices">Not connected</span>
        </div>
    </div>

    <!-- Chat Service -->
    <div class="container">
        <div class="service-section">
            <h3>💬 Chat Service</h3>
            <div class="controls">
                <input type="text" id="chatChannel" placeholder="Channel name" value="general">
                <button id="joinChatBtn">Join Channel</button>
                <button id="leaveChatBtn" disabled>Leave Channel</button>
                <button id="getChatHistoryBtn" disabled>Get History</button>
            </div>
            <div class="controls">
                <input type="text" id="chatMessage" placeholder="Type a message..." style="flex: 1;">
                <button id="sendChatBtn" disabled>Send</button>
            </div>
            <div id="chatLog" class="log-container"></div>
        </div>
    </div>

    <!-- Presence Service -->
    <div class="container">
        <div class="service-section">
            <h3>👥 Presence Service</h3>
            <div class="controls">
                <select id="presenceStatus">
                    <option value="online">Online</option>
                    <option value="busy">Busy</option>
                    <option value="away">Away</option>
                    <option value="offline">Offline</option>
                </select>
                <input type="text" id="presenceChannel" placeholder="Channel name" value="general">
                <button id="setPresenceBtn">Set Presence</button>
                <button id="subscribePresenceBtn">Subscribe</button>
                <button id="unsubscribePresenceBtn" disabled>Unsubscribe</button>
            </div>
            <div id="presenceLog" class="log-container"></div>
        </div>
    </div>

    <!-- Cursor Service -->
    <div class="container">
        <div class="service-section">
            <h3>🖱️ Cursor Service</h3>
            <div class="controls">
                <input type="text" id="cursorChannel" placeholder="Channel name" value="general">
                <button id="subscribeCursorBtn">Subscribe</button>
                <button id="unsubscribeCursorBtn" disabled>Unsubscribe</button>
                <button id="getCursorModesBtn">Get Modes</button>
            </div>
            <div id="cursorDemo" class="cursor-demo">
                <div style="position: absolute; top: 10px; left: 10px; font-size: 12px; color: #666;">
                    Move your mouse in this area to share cursor position
                </div>
            </div>
            <div id="cursorLog" class="log-container"></div>
        </div>
    </div>

    <!-- Reaction Service -->
    <div class="container">
        <div class="service-section">
            <h3>😊 Reaction Service</h3>
            <div class="controls">
                <input type="text" id="reactionChannel" placeholder="Channel name" value="general">
                <button id="subscribeReactionBtn">Subscribe</button>
                <button id="unsubscribeReactionBtn" disabled>Unsubscribe</button>
                <button id="getAvailableReactionsBtn">Get Available</button>
            </div>
            <div class="reaction-buttons">
                <button class="reaction-button" data-emoji="❤️">❤️</button>
                <button class="reaction-button" data-emoji="😂">😂</button>
                <button class="reaction-button" data-emoji="👍">👍</button>
                <button class="reaction-button" data-emoji="👎">👎</button>
                <button class="reaction-button" data-emoji="😮">😮</button>
                <button class="reaction-button" data-emoji="😢">😢</button>
                <button class="reaction-button" data-emoji="😡">😡</button>
                <button class="reaction-button" data-emoji="🎉">🎉</button>
                <button class="reaction-button" data-emoji="🔥">🔥</button>
                <button class="reaction-button" data-emoji="⚡">⚡</button>
                <button class="reaction-button" data-emoji="💯">💯</button>
                <button class="reaction-button" data-emoji="🚀">🚀</button>
            </div>
            <div id="reactionDisplay" class="reaction-display"></div>
            <div id="reactionLog" class="log-container"></div>
        </div>
    </div>

    <!-- Global Log -->
    <div class="container">
        <h2>📋 Global Event Log</h2>
        <div id="globalLog" class="log-container"></div>
    </div>

    <script src="websocket-gateway-sdk.js"></script>
    <script>
        class WebSocketGatewayTestClient {
            constructor() {
                this.sdk = null;
                this.connected = false;
                this.currentChannels = {
                    chat: null,
                    presence: null,
                    cursor: null,
                    reaction: null
                };
                this.cursors = new Map();
                this.setupEventListeners();
            }

            setupEventListeners() {
                // Connection controls
                document.getElementById('connectBtn').addEventListener('click', () => this.connect());
                document.getElementById('disconnectBtn').addEventListener('click', () => this.disconnect());

                // Chat controls
                document.getElementById('joinChatBtn').addEventListener('click', () => this.joinChat());
                document.getElementById('leaveChatBtn').addEventListener('click', () => this.leaveChat());
                document.getElementById('sendChatBtn').addEventListener('click', () => this.sendChat());
                document.getElementById('getChatHistoryBtn').addEventListener('click', () => this.getChatHistory());
                document.getElementById('chatMessage').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendChat();
                });

                // Presence controls
                document.getElementById('setPresenceBtn').addEventListener('click', () => this.setPresence());
                document.getElementById('subscribePresenceBtn').addEventListener('click', () => this.subscribePresence());
                document.getElementById('unsubscribePresenceBtn').addEventListener('click', () => this.unsubscribePresence());

                // Cursor controls
                document.getElementById('subscribeCursorBtn').addEventListener('click', () => this.subscribeCursor());
                document.getElementById('unsubscribeCursorBtn').addEventListener('click', () => this.unsubscribeCursor());
                document.getElementById('getCursorModesBtn').addEventListener('click', () => this.getCursorModes());
                
                // Cursor demo
                const cursorDemo = document.getElementById('cursorDemo');
                cursorDemo.addEventListener('mousemove', (e) => this.handleMouseMove(e));
                cursorDemo.addEventListener('mouseleave', () => this.handleMouseLeave());

                // Reaction controls
                document.getElementById('subscribeReactionBtn').addEventListener('click', () => this.subscribeReaction());
                document.getElementById('unsubscribeReactionBtn').addEventListener('click', () => this.unsubscribeReaction());
                document.getElementById('getAvailableReactionsBtn').addEventListener('click', () => this.getAvailableReactions());
                
                // Reaction buttons
                document.querySelectorAll('.reaction-button').forEach(button => {
                    button.addEventListener('click', (e) => this.sendReaction(e.target.dataset.emoji));
                });
            }

            connect() {
                const url = document.getElementById('wsUrl').value;
                this.sdk = new WebSocketGatewaySDK({ 
                    wsUrl: url, 
                    debug: true,
                    autoConnect: false
                });

                this.setupSDKEventHandlers();
                this.sdk.connect();
                this.updateConnectionStatus('Connecting...', 'disconnected');
                this.updateButtons();
            }

            setupSDKEventHandlers() {
                // Connection events
                this.sdk.on('connected', (data) => {
                    this.connected = true;
                    this.updateConnectionStatus('Connected', 'connected');
                    this.updateNodeInfo(data);
                    this.updateButtons();
                    this.log('system', 'Connected to WebSocket server', 'success');
                });

                this.sdk.on('disconnected', () => {
                    this.connected = false;
                    this.updateConnectionStatus('Disconnected', 'disconnected');
                    this.updateNodeInfo(null);
                    this.updateButtons();
                    this.log('system', 'Disconnected from WebSocket server', 'error');
                });

                this.sdk.on('error', (error) => {
                    this.log('system', `Error: ${error.message}`, 'error');
                });

                // Chat events
                this.sdk.on('chat:joined', (data) => {
                    this.currentChannels.chat = data.channel;
                    this.updateButtons();
                    this.log('chat', `Joined channel: ${data.channel}`, 'success');
                });

                this.sdk.on('chat:left', (data) => {
                    this.currentChannels.chat = null;
                    this.updateButtons();
                    this.log('chat', `Left channel: ${data.channel}`, 'info');
                });

                this.sdk.on('chat:message', (data) => {
                    this.log('chat', `[${data.channel}] ${data.clientId}: ${data.message}`, 'info');
                });

                this.sdk.on('chat:history', (data) => {
                    this.log('chat', `History loaded for ${data.channel}: ${data.messages.length} messages`, 'info');
                    data.messages.forEach(msg => {
                        this.log('chat', `[${msg.channel}] ${msg.clientId}: ${msg.message}`, 'info');
                    });
                });

                this.sdk.on('chat:error', (data) => {
                    this.log('chat', `Error: ${data.message}`, 'error');
                });

                // Presence events
                this.sdk.on('presence:subscribed', (data) => {
                    this.currentChannels.presence = data.channel;
                    this.updateButtons();
                    this.log('presence', `Subscribed to presence in: ${data.channel}`, 'success');
                    if (data.users) {
                        data.users.forEach(user => {
                            this.log('presence', `${user.clientId}: ${user.status}`, 'info');
                        });
                    }
                });

                this.sdk.on('presence:unsubscribed', (data) => {
                    this.currentChannels.presence = null;
                    this.updateButtons();
                    this.log('presence', `Unsubscribed from presence in: ${data.channel}`, 'info');
                });

                this.sdk.on('presence:update', (data) => {
                    this.log('presence', `${data.clientId}: ${data.presence.status}`, 'info');
                });

                this.sdk.on('presence:offline', (data) => {
                    this.log('presence', `${data.clientId}: offline`, 'info');
                });

                this.sdk.on('presence:error', (data) => {
                    this.log('presence', `Error: ${data.message}`, 'error');
                });

                // Cursor events
                this.sdk.on('cursor:subscribed', (data) => {
                    this.currentChannels.cursor = data.channel;
                    this.updateButtons();
                    this.log('cursor', `Subscribed to cursors in: ${data.channel}`, 'success');
                    if (data.cursors) {
                        data.cursors.forEach(cursor => {
                            this.updateCursorDisplay(cursor);
                        });
                    }
                });

                this.sdk.on('cursor:unsubscribed', (data) => {
                    this.currentChannels.cursor = null;
                    this.updateButtons();
                    this.clearCursors();
                    this.log('cursor', `Unsubscribed from cursors in: ${data.channel}`, 'info');
                });

                this.sdk.on('cursor:update', (cursor) => {
                    this.updateCursorDisplay(cursor);
                    this.log('cursor', `${cursor.clientId}: ${cursor.position.x}, ${cursor.position.y}`, 'info');
                });

                this.sdk.on('cursor:remove', (data) => {
                    this.removeCursorDisplay(data.clientId);
                    this.log('cursor', `${data.clientId}: removed`, 'info');
                });

                this.sdk.on('cursor:error', (data) => {
                    this.log('cursor', `Error: ${data.message}`, 'error');
                });

                // Reaction events
                this.sdk.on('reaction:subscribed', (data) => {
                    this.currentChannels.reaction = data.channel;
                    this.updateButtons();
                    this.log('reaction', `Subscribed to reactions in: ${data.channel}`, 'success');
                });

                this.sdk.on('reaction:unsubscribed', (data) => {
                    this.currentChannels.reaction = null;
                    this.updateButtons();
                    this.log('reaction', `Unsubscribed from reactions in: ${data.channel}`, 'info');
                });

                this.sdk.on('reaction:received', (data) => {
                    this.displayReaction(data.emoji, data.metadata);
                    this.log('reaction', `${data.clientId}: ${data.emoji}`, 'info');
                });

                this.sdk.on('reaction:available', (data) => {
                    this.log('reaction', `Available reactions: ${data.reactions.length}`, 'info');
                    data.reactions.forEach(reaction => {
                        this.log('reaction', `${reaction.emoji}: ${reaction.name}`, 'info');
                    });
                });

                this.sdk.on('reaction:error', (data) => {
                    this.log('reaction', `Error: ${data.message}`, 'error');
                });
            }

            disconnect() {
                if (this.sdk) {
                    this.sdk.disconnect();
                    this.sdk = null;
                }
                this.connected = false;
                this.currentChannels = {
                    chat: null,
                    presence: null,
                    cursor: null,
                    reaction: null
                };
                this.clearCursors();
                this.updateButtons();
            }

            // Chat methods
            joinChat() {
                if (!this.connected) return;
                const channel = document.getElementById('chatChannel').value;
                if (!channel) return;
                
                this.sdk.chat.join(channel, { 
                    userAgent: navigator.userAgent,
                    timestamp: Date.now()
                });
            }

            leaveChat() {
                if (!this.connected || !this.currentChannels.chat) return;
                this.sdk.chat.leave(this.currentChannels.chat);
            }

            sendChat() {
                if (!this.connected || !this.currentChannels.chat) return;
                const message = document.getElementById('chatMessage').value;
                if (!message) return;
                
                this.sdk.chat.send(this.currentChannels.chat, message, {
                    timestamp: Date.now()
                });
                document.getElementById('chatMessage').value = '';
            }

            getChatHistory() {
                if (!this.connected || !this.currentChannels.chat) return;
                this.sdk.chat.getHistory(this.currentChannels.chat, 50);
            }

            // Presence methods
            setPresence() {
                if (!this.connected) return;
                const status = document.getElementById('presenceStatus').value;
                const channel = document.getElementById('presenceChannel').value;
                
                this.sdk.presence.set(status, {
                    timestamp: Date.now(),
                    userAgent: navigator.userAgent
                }, channel ? [channel] : []);
            }

            subscribePresence() {
                if (!this.connected) return;
                const channel = document.getElementById('presenceChannel').value;
                if (!channel) return;
                
                this.sdk.presence.subscribe(channel);
            }

            unsubscribePresence() {
                if (!this.connected || !this.currentChannels.presence) return;
                this.sdk.presence.unsubscribe(this.currentChannels.presence);
            }

            // Cursor methods
            subscribeCursor() {
                if (!this.connected) return;
                const channel = document.getElementById('cursorChannel').value;
                if (!channel) return;
                
                this.sdk.cursor.subscribe(channel, 'freeform');
            }

            unsubscribeCursor() {
                if (!this.connected || !this.currentChannels.cursor) return;
                this.sdk.cursor.unsubscribe(this.currentChannels.cursor);
            }

            getCursorModes() {
                if (!this.connected) return;
                this.sdk.cursor.getModes();
            }

            handleMouseMove(e) {
                if (!this.connected || !this.currentChannels.cursor) return;
                
                const rect = e.currentTarget.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                this.sdk.cursor.freeform.update(this.currentChannels.cursor, x, y, {
                    timestamp: Date.now()
                });
            }

            handleMouseLeave() {
                if (!this.connected || !this.currentChannels.cursor) return;
                // Could implement cursor hiding here
            }

            // Reaction methods
            subscribeReaction() {
                if (!this.connected) return;
                const channel = document.getElementById('reactionChannel').value;
                if (!channel) return;
                
                this.sdk.reaction.subscribe(channel);
            }

            unsubscribeReaction() {
                if (!this.connected || !this.currentChannels.reaction) return;
                this.sdk.reaction.unsubscribe(this.currentChannels.reaction);
            }

            getAvailableReactions() {
                if (!this.connected) return;
                this.sdk.reaction.getAvailable();
            }

            sendReaction(emoji) {
                if (!this.connected || !this.currentChannels.reaction) return;
                
                this.sdk.reaction.send(this.currentChannels.reaction, emoji, {
                    timestamp: Date.now()
                });
            }

            // UI Update methods
            updateConnectionStatus(status, className) {
                const statusElement = document.getElementById('connectionStatus');
                statusElement.textContent = status;
                statusElement.className = `status ${className}`;
            }

            updateNodeInfo(data) {
                document.getElementById('clientId').textContent = data?.clientId || 'Not connected';
                document.getElementById('nodeId').textContent = data?.nodeId || 'Not connected';
                document.getElementById('enabledServices').textContent = data?.enabledServices?.join(', ') || 'Not connected';
            }

            updateButtons() {
                document.getElementById('connectBtn').disabled = this.connected;
                document.getElementById('disconnectBtn').disabled = !this.connected;
                
                document.getElementById('joinChatBtn').disabled = !this.connected || this.currentChannels.chat;
                document.getElementById('leaveChatBtn').disabled = !this.connected || !this.currentChannels.chat;
                document.getElementById('sendChatBtn').disabled = !this.connected || !this.currentChannels.chat;
                document.getElementById('getChatHistoryBtn').disabled = !this.connected || !this.currentChannels.chat;
                
                document.getElementById('setPresenceBtn').disabled = !this.connected;
                document.getElementById('subscribePresenceBtn').disabled = !this.connected || this.currentChannels.presence;
                document.getElementById('unsubscribePresenceBtn').disabled = !this.connected || !this.currentChannels.presence;
                
                document.getElementById('subscribeCursorBtn').disabled = !this.connected || this.currentChannels.cursor;
                document.getElementById('unsubscribeCursorBtn').disabled = !this.connected || !this.currentChannels.cursor;
                document.getElementById('getCursorModesBtn').disabled = !this.connected;
                
                document.getElementById('subscribeReactionBtn').disabled = !this.connected || this.currentChannels.reaction;
                document.getElementById('unsubscribeReactionBtn').disabled = !this.connected || !this.currentChannels.reaction;
                document.getElementById('getAvailableReactionsBtn').disabled = !this.connected;
                
                document.querySelectorAll('.reaction-button').forEach(button => {
                    button.disabled = !this.connected || !this.currentChannels.reaction;
                });
            }

            updateCursorDisplay(cursor) {
                const demo = document.getElementById('cursorDemo');
                let cursorElement = demo.querySelector(`[data-client-id="${cursor.clientId}"]`);
                
                if (!cursorElement) {
                    cursorElement = document.createElement('div');
                    cursorElement.className = 'cursor-indicator';
                    if (cursor.clientId === this.sdk.clientId) {
                        cursorElement.classList.add('own');
                    }
                    cursorElement.setAttribute('data-client-id', cursor.clientId);
                    
                    const label = document.createElement('div');
                    label.className = 'cursor-label';
                    label.textContent = cursor.clientId.substring(0, 8);
                    cursorElement.appendChild(label);
                    
                    demo.appendChild(cursorElement);
                }
                
                cursorElement.style.left = cursor.position.x + 'px';
                cursorElement.style.top = cursor.position.y + 'px';
                
                this.cursors.set(cursor.clientId, cursor);
            }

            removeCursorDisplay(clientId) {
                const demo = document.getElementById('cursorDemo');
                const cursorElement = demo.querySelector(`[data-client-id="${clientId}"]`);
                if (cursorElement) {
                    cursorElement.remove();
                }
                this.cursors.delete(clientId);
            }

            clearCursors() {
                const demo = document.getElementById('cursorDemo');
                demo.querySelectorAll('.cursor-indicator').forEach(el => el.remove());
                this.cursors.clear();
            }

            displayReaction(emoji, metadata) {
                const display = document.getElementById('reactionDisplay');
                const reaction = document.createElement('div');
                reaction.className = 'reaction-animation';
                reaction.textContent = emoji;
                reaction.style.left = Math.random() * (display.offsetWidth - 30) + 'px';
                reaction.style.top = Math.random() * (display.offsetHeight - 30) + 'px';
                
                // Add effect class based on emoji
                const effectMap = {
                    '❤️': 'effect-pulse-red',
                    '😂': 'effect-shake',
                    '👍': 'effect-bounce-green',
                    '👎': 'effect-bounce-red',
                    '😮': 'effect-zoom',
                    '😢': 'effect-fade-blue',
                    '😡': 'effect-shake-red',
                    '🎉': 'effect-confetti',
                    '🔥': 'effect-flicker-orange',
                    '⚡': 'effect-flash-yellow',
                    '💯': 'effect-spin-gold',
                    '🚀': 'effect-fly-up'
                };
                
                if (effectMap[emoji]) {
                    reaction.classList.add(effectMap[emoji]);
                }
                
                display.appendChild(reaction);
                
                // Remove after animation
                setTimeout(() => {
                    if (reaction.parentNode) {
                        reaction.parentNode.removeChild(reaction);
                    }
                }, 2000);
            }

            log(service, message, level = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const entry = document.createElement('div');
                entry.className = `log-entry log-${service} log-${level}`;
                entry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> <strong>${service.toUpperCase()}:</strong> ${message}`;
                
                // Add to service-specific log
                const serviceLogId = service === 'system' ? 'globalLog' : `${service}Log`;
                const serviceLog = document.getElementById(serviceLogId);
                if (serviceLog) {
                    serviceLog.appendChild(entry.cloneNode(true));
                    serviceLog.scrollTop = serviceLog.scrollHeight;
                }
                
                // Add to global log
                const globalLog = document.getElementById('globalLog');
                globalLog.appendChild(entry);
                globalLog.scrollTop = globalLog.scrollHeight;
            }
        }

        // Initialize the test client
        const testClient = new WebSocketGatewayTestClient();
    </script>
</body>
</html>
